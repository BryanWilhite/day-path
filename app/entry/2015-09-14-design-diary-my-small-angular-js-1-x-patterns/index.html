<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="ie=edge" />
        <meta name="description" content="my technical Blog ✒ for my studio" />
        <meta name="robots" content="index, follow" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <meta name="google-site-verification" content="MyXJp0qYgoTSi472GCarwPFWqvRZAo8khVV_FXV33tI" />
        <meta name="msvalidate.01" content="9C08B066B4967EBE515E0CC7C146DE30" />

        <base href="http://songhayblog.azurewebsites.net/" />

        <link rel="canonical" href="http://songhayblog.azurewebsites.net/" />
        <link rel="alternate" type="application/atom+xml" title="day path" href="/entry/feed.xml" />
        <link rel="SHORTCUT ICON" href="http://songhayblog.azurewebsites.net/image/favicon.ico" />
        <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
        <link href="http://songhayblog.azurewebsites.net/style/styles.min.css" rel="stylesheet" />

        <script src="http://songhayblog.azurewebsites.net/script/index.min.js"></script>

        <title>Design Diary: my small Angular JS 1.x patterns - day path</title>
    </head>

    <body class="mdc-typography">
        <header class="mdc-top-app-bar mdc-top-app-bar--short">
            <div class="mdc-top-app-bar__row">
                <section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-start">
                    <a href="http://songhayblog.azurewebsites.net/" class="material-icons mdc-top-app-bar__navigation-icon">first_page</a>
                    <span class="mdc-top-app-bar__title">day path</span>
                </section>
                <section class="description mdc-top-app-bar__section mdc-top-app-bar__section--align-end">
                    my technical Blog ✒ for my studio
                </section>
            </div>
        </header>
        <main class="mdc-layout-grid" id="main-content">
            <section class="entry">

    <h1>Design Diary: my small Angular JS 1.x patterns</h1>
<p>My recent work with <a href="http://codepen.io/rasx/pen/dPoPbV">the redesign/upgrade of kintespace.com</a> leaves me with a few Angular JS patterns that must be memorialized here, literally for my own (mental) health.</p>
<h2>Using a data Service with dirt-simple caching based on $q</h2>
<p>‘Dirt-simple’ caching is a system that loads data once and stores the data until the system restarted. I am sure there is a more academic name for this design—nevertheless, this is what ‘dirt-simple’ caching looks like as an Angular service:</p>
<script src="https://gist.github.com/BryanWilhite/22c7416b5bba10873546.js"></script>
<p>What we see in the gist is an Angular service with three methods: <code>cacheData()</code>, <code>getDataFromCache()</code>, and <code>loadIndex()</code>. This service is from an Angular app displays Index data so <code>loadIndex()</code> is called every time the App is loaded—and every time the Index partial View is requested.</p>
<p>These two lines of code represent the “secret sauce” of this dirt-simple design:</p>
<pre><code class="language-javascript">var cachedResponse = this.getDataFromCache(uri);
return cachedResponse? $q.when(cachedResponse) : $http.get(uri).then(…);
</code></pre>
<p>That last line—that ternary operation featuring <code>$q.when()</code> (<a href="https://docs.angularjs.org/api/ng/service/$q">from Angular JS</a>) makes things dirt simple.</p>
<h2>Using ngView <em>and</em> custom directives</h2>
<p>I started using <code>ngView</code> to <em>avoid</em> delving into building my own directives. In “<a href="http://songhayblog.azurewebsites.net/">My Angular JS 1.x single-page layout</a>,” I am making myself familiar with the need to use <em>very</em> simple custom directives—typically header and footer directives, wrapping <code>ngView</code>—to give me a little headroom in layout expressiveness. Here’s an example of a header Directive:</p>
<pre><code class="language-javascript">var doHeaderDirective = function () {
    return {
        restrict: &quot;E&quot;,
        scope: false,
        templateUrl: &quot;./app/partials/headerFlow.html&quot;
    };
};
</code></pre>
<h2>Using a Client View Model to provide binding for a Directive outside of ngView scope</h2>
<p>The header Directive shown above, has its scope option set to <code>false</code> (which means it will inherit its Controller scope). But when the header is loaded outside of <code>ngView</code> what controller is associated with it? To answer this question, I’ve developed this pattern using <code>ngController</code>:</p>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html data-ng-app=&quot;rxApp&quot;&gt;
&lt;head&gt;…&lt;/head&gt;
&lt;body&gt;
&lt;div class=&quot;container&quot; data-ng-controller=&quot;clientController&quot;&gt;
    &lt;rx-header /&gt;
    &lt;div class=&quot;row&quot; data-ng-view=&quot;&quot;&gt;…&lt;/div&gt;
&lt;/div&gt;
&lt;rx-footer /&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>I can define View Model inside of <code>clientController</code> that can be used for data binding, etc. <em>outside</em> of <code>ngView</code>. This may be obvious to many Angular folks but I can see how a beginner can fall in the trap of thinking one should use <code>ngView</code> <em>or</em> <code>ngController</code> instead of <em>both</em> of them.</p>
<h2>Using Angular UI pagination with Underscore-JS sorting</h2>
<p>My little <a href="https://gist.github.com/BryanWilhite/5a634fd6ce237d6d0107">gist about paging and sorting</a> shows key fragments of the design, featuring a Pagination Service driven by a Controller that uses <a href="http://underscorejs.org/">Underscore JS</a> to sort the data before passing it to this service. We of course <em>see</em> the pagination through the markup in the partial, <a href="http://angular-ui.github.io/bootstrap/">documented on GitHub</a>.</p>
<p>The Pagination Service has only one expectation for the data it uses: the data must be an array. The <code>start()</code> method starts pagination and it called from the controller:</p>
<pre><code class="language-javascript">$scope.clientVM.dataService.loadData(&quot;index-&quot; + indexMetaId).then(function (response) {
    that.data = _(response.data.ChildDocuments)
        .chain()
        .filter(function (i) {
            return (!_.isUndefined(i) &amp;&amp; !_.isNull(i));
        }).sortBy(function (i) {
            return i.CreateDate;
        })
        .value()
        .reverse();
    that.pagination.start(that.data);
    that.pagination.isVisible = true;
    $scope.clientVM.isDataLoaded = true;
    $scope.clientVM.isSplash = false;
});
</code></pre>
<h2>Using ngClass, $parent, $first and the Client View Model with ngRepeat</h2>
<p>The import discovery for me here is <code>ngClass</code>. I feel like I should have learned about <code>ngClass</code> before I started building Angular JS sites—this is a super-easy way to associate CSS class names with Controller logic (it is effectively the equivalent of <code>.addClass()</code>, <code>.hasClass()</code>, <code>.removeClass()</code>, <code>.toggleClass()</code> in jQuery).</p>
<p><a href="https://gist.github.com/BryanWilhite/0b0484102980acf5ccb2">This gist</a> sketches out how a repeated set of headers, associated with <code>ngView</code> routes, changes CSS classes based on the route:</p>
<script src="https://gist.github.com/BryanWilhite/0b0484102980acf5ccb2.js"></script>
<p>The use of <code>$parent</code> in the partial implies that the partial is loaded in <code>ngView</code> and <code>ClientVM</code> is the Client View Model of the <code>$parent</code> scope ‘above’ the controller of the <code>ngView</code>. (See “Using a Client View Model to provide binding for a Directive outside of <code>ngView</code> scope” above.)</p>
<p>The use of <code>$first</code> in the markup is passed to the <code>isFirst</code> parameter of <code>clientVM.isIndexSubsetHeaderSelected()</code>. It is used to make a default selection for initial load.</p>
<h2>Using a custom function for a filter with nqRepeat</h2>
<p>This declaration refers to a function, <code>vm.filterGroups()</code>:</p>
<pre><code class="language-plaintext">data-ng-repeat=&quot;i in groups | filter:vm.filterGroups
</code></pre>
<p>In this particular case, the filter function is part of a View Model that is entirely devoted to filtering:</p>
<pre><code class="language-javascript">$scope.vm = {
    filterExpression: null,
    filterGroup: function (data) {
        var filterExpression = $scope.vm.filterExpression;
        if (!filterExpression) {
            return true;
        }
        filterExpression = filterExpression.toLowerCase();
        var title = data.Title;
        var isContainedInTitle = (title &amp;&amp; title.toLowerCase().indexOf(filterExpression) === -1) ? false : true;
        return isContainedInTitle;
    },
    filterGroups: function (data) {
        if (!data.group) {
            return true;
        }
        var filteredItems = _(data.group).filter($scope.vm.filterGroup);
        var hasGroupItems = (filteredItems &amp;&amp; (filteredItems.length &gt; 0)) ? true : false;
        return hasGroupItems;
    },
};
</code></pre>
<p>The <code>filterExpression</code> property is bound to an <code>input[type=&quot;text&quot;]</code> element:</p>
<input data-ng-model="vm.filterExpression" type="text" class="form-control" placeholder="search">
<p>The Angular documentation clearly specifies the use of a “<a href="https://docs.angularjs.org/api/ng/filter/filter">predicate function</a>” for filter expressions.</p>
<p>@<a href="https://twitter.com/BryanWilhite">BryanWilhite</a></p>


</section>
<section class="meta">
    <span class="entry-date"> <strong>incept date:</strong> EEEE, MMMM d, y </span>
</section>
        </main>
        <footer>
            <div class="col-sm-8">
                <p>
                    Last Reviewed:
                    2015-09-14T20:41:02.783Z
                </p>
                <p>
                    Another stone tribal move by <a class="welcome" href="http://songhaysystem.com/">Songhay System</a>
                </p>
            </div>
            <div class="col-sm-4">
                <a href="http://twitter.com/BryanWilhite" target="_blank" title="@BryanWilhite">
                    <span class="zocial twitter icon"></span>
                </a>
                <a href="http://songhayblog.azurewebsites.net/entry/feed.xml" target="_blank" title="Atom feed">
                    <span class="zocial rss icon"></span>
                </a>
            </div>
        </footer>
    </body>

</html>