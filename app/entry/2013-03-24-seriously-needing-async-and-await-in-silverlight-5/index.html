<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="ie=edge" />
        <meta name="description" content="my technical Blog ✒ for my studio" />
        <meta name="robots" content="index, follow" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <meta name="google-site-verification" content="MyXJp0qYgoTSi472GCarwPFWqvRZAo8khVV_FXV33tI" />
        <meta name="msvalidate.01" content="9C08B066B4967EBE515E0CC7C146DE30" />

        <base href="http://songhayblog.azurewebsites.net/" />

        <link rel="canonical" href="http://songhayblog.azurewebsites.net/" />
        <link rel="alternate" type="application/atom+xml" title="day path" href="/entry/feed.xml" />
        <link rel="SHORTCUT ICON" href="http://songhayblog.azurewebsites.net/image/favicon.ico" />
        <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
        <link href="http://songhayblog.azurewebsites.net/style/styles.min.css" rel="stylesheet" />

        <script src="http://songhayblog.azurewebsites.net/script/index.min.js"></script>

        <title>Seriously Needing async and await in Silverlight 5 - day path</title>
    </head>

    <body class="mdc-typography">
        <header class="mdc-top-app-bar mdc-top-app-bar--short">
            <div class="mdc-top-app-bar__row">
                <section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-start">
                    <a href="http://songhayblog.azurewebsites.net/" class="material-icons mdc-top-app-bar__navigation-icon">first_page</a>
                    <span class="mdc-top-app-bar__title">day path</span>
                </section>
                <section class="description mdc-top-app-bar__section mdc-top-app-bar__section--align-end">
                    my technical Blog ✒ for my studio
                </section>
            </div>
        </header>
        <main class="mdc-layout-grid" id="main-content">
            <section class="entry">

    <h1>Seriously Needing async and await in Silverlight 5</h1>
<p>In the “long forgotten,” “dead,” Silverlight projects I work with every day these days. I establish a pattern featuring a huge “main” View Model I call <code>ClientViewModel</code>. This monstrosity is a partial class of files like these:</p>
<pre><code class="language-console">ClientViewModel._.cs
ClientViewModel.Commanding.cs
ClientViewModel.Eventing.cs
ClientViewModel.Messaging.cs
ClientViewModel.Navigating.cs
ClientViewModel.RiaOperations.cs
</code></pre>
<p>We can see why this class can be so huge when it concerns itself with the Commands, Events, Messages, Navigation and RIA Operations of an entire application. To answer an imaginary question—yes, I do expect to have other View Models classes, respecting the Single Responsibility Principle (usually these other View Models appear at or below the Page level of the application. When <code>ClientViewModel</code> is considered too big then it’s time to get “fast and fluid” and break the entire application up into smaller apps.</p>
<p>Inside of <code>ClientViewModel.RiaOperations.cs</code> are a bunch of RIA Services calls. My tendency these days is to centralize <em>all</em> RIA service calls in this file. My service calls are private methods with the prefix <code>DoRiaOperationFor</code>. So for “classic” Silverlight at the beginning of the Visual Studio 2010 timeframe, we would have this:</p>
<pre><code class="language-c#">void DoRiaOperationForCustomerApproval(IEnumerable&lt;Customer&gt; data)
{
    var operation = context.DoCustomerApprovals(data);
    operation.Completed += (s, args) =&gt;
    {
        //Handle any errors or nulls...
        //reload Customers:
        this.DoRiaOperationForCustomerStatus();
    }
}
</code></pre>
<p>We see that <code>DoRiaOperationForCustomerApproval()</code> approves customers. After the customers are approved, the Customer data is refreshed by <code>DoRiaOperationForCustomerStatus()</code>—the naming here suggests that there must be some kind of “Customer Status” view (where customers can be marked “approved”).</p>
<p>Since <code>DoRiaOperationForCustomerApproval()</code> is not run in parallel with other operations, we can see that using the Task Parallel Library is not very helpful:</p>
<pre><code class="language-c#">void DoRiaOperationForCustomerApproval(IEnumerable&lt;Customer&gt; data)
{
    context.DoCustomerApprovals(data).AsTask()
        .ContinueWith(
            completedTask =&gt;
            {
                //Handle any errors or nulls...
                //reload Customers:
                this.DoRiaOperationForCustomerStatus();
            });
}
</code></pre>
<p>The syntax looks almost the same as the event-based pattern out of the box. But what’s this <code>.AsTask()</code> method? This is an extension method from <a href="http://blogs.msdn.com/b/kylemc/archive/2010/11/02/using-the-visual-studio-async-ctp-with-ria-services.aspx">Kyle McClellan</a> (from the year 2010).</p>
<p>After installing the NuGet package, <code>Microsoft.CompilerServices.AsyncTargetingPack</code>, I can use Kyle’s extension method to obtain this pattern:</p>
<pre><code class="language-c#">async void DoRiaOperationForCustomerApproval(IEnumerable&lt;Customer&gt; data)
{
    var task = await context.DoCustomerApprovals(data).AsTask();
    //Handle any errors or nulls...
    //reload Customers:
    this.DoRiaOperationForCustomerStatus();
}
</code></pre>
<p>What <code>async</code> and <code>await</code> gives me is a <em>flat</em> representation of my intentions. Without <code>async</code> and <code>await</code> I run the risk of nesting <code>OperationBase.Completed</code> calls, making my intent confusing. I seriously need <code>async</code> and <code>await</code>.</p>
<p>Welcome to 2012 in the year 2013. Silverlight is dead. Long live Silverlight.</p>
<p>@<a href="https://twitter.com/BryanWilhite">BryanWilhite</a></p>


</section>
<section class="meta">
    <span class="entry-date"> <strong>incept date:</strong> EEEE, MMMM d, y </span>
</section>
        </main>
        <footer>
            <div class="col-sm-8">
                <p>
                    Last Reviewed:
                    2013-03-25T00:00:00.000Z
                </p>
                <p>
                    Another stone tribal move by <a class="welcome" href="http://songhaysystem.com/">Songhay System</a>
                </p>
            </div>
            <div class="col-sm-4">
                <a href="http://twitter.com/BryanWilhite" target="_blank" title="@BryanWilhite">
                    <span class="zocial twitter icon"></span>
                </a>
                <a href="http://songhayblog.azurewebsites.net/entry/feed.xml" target="_blank" title="Atom feed">
                    <span class="zocial rss icon"></span>
                </a>
            </div>
        </footer>
    </body>

</html>